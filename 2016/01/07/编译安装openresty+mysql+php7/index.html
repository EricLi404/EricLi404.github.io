<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="本文记录了笔者在CentOS编译安装openresty+mysql+php7的过程。"/>




  <meta name="keywords" content="database,MySQL,PHP," />





  <link rel="alternate" href="/atom.xml" title="DropLet">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://ericli.top/2016/01/07/编译安装openresty+mysql+php7/"/>


<meta name="description" content="本文记录了笔者在CentOS编译安装openresty+mysql+php7的过程。">
<meta name="keywords" content="database,MySQL,PHP">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS编译安装openresty+mysql+php7">
<meta property="og:url" content="http://ericli.top/2016/01/07/编译安装openresty+mysql+php7/index.html">
<meta property="og:site_name" content="DropLet">
<meta property="og:description" content="本文记录了笔者在CentOS编译安装openresty+mysql+php7的过程。">
<meta property="og:updated_time" content="2020-02-19T09:49:02.432Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS编译安装openresty+mysql+php7">
<meta name="twitter:description" content="本文记录了笔者在CentOS编译安装openresty+mysql+php7的过程。">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> CentOS编译安装openresty+mysql+php7 - DropLet </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">DropLet</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          CentOS编译安装openresty+mysql+php7
        
      </h1>

      <time class="post-time">
          Jan 07 2016
      </time>
    </header>



    
            <div class="post-content">
            <h1 id="1-准备"><a href="#1-准备" class="headerlink" title="1.准备"></a>1.准备</h1><h3 id="1-更新系统"><a href="#1-更新系统" class="headerlink" title="1.更新系统"></a>1.更新系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache &amp;&amp; yum -y update</span><br></pre></td></tr></table></figure>
<h3 id="2-安装常用基础软件"><a href="#2-安装常用基础软件" class="headerlink" title="2.安装常用基础软件"></a>2.安装常用基础软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bash-completion vim net-tools bind-utils wget screen</span><br></pre></td></tr></table></figure>
<p>最后别忘了重启</p>
<h3 id="3-需要下载的源码"><a href="#3-需要下载的源码" class="headerlink" title="3.需要下载的源码"></a>3.需要下载的源码</h3><blockquote>
<h4 id="1-openresty"><a href="#1-openresty" class="headerlink" title="1.openresty"></a>1.openresty</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://openresty.org/download/ngx_openresty-1.9.7.1.tar.gz</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="2-mariaDB"><a href="#2-mariaDB" class="headerlink" title="2.mariaDB"></a>2.mariaDB</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://sfo1.mirrors.digitalocean.com/mariadb/mariadb-5.5.47/source/mariadb-5.5.47.tar.gz</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="3-php7"><a href="#3-php7" class="headerlink" title="3.php7"></a>3.php7</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c --no-check-certificate -O php7-src-master.zip https://github.com/php/php-src/archive/master.zip</span><br></pre></td></tr></table></figure>
<h1 id="2-openresty"><a href="#2-openresty" class="headerlink" title="2.openresty"></a>2.openresty</h1><blockquote>
<h3 id="1-依赖关系"><a href="#1-依赖关系" class="headerlink" title="1.依赖关系"></a>1.依赖关系</h3></blockquote>
<p>openresty依赖于perl 5.6.1+, libreadline, libpcre, libssl，首先安装依赖关系。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install readline-devel pcre-devel openssl-devel gcc</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="2-下载源码"><a href="#2-下载源码" class="headerlink" title="2.下载源码"></a>2.下载源码</h3></blockquote>
<p>使用wget下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://openresty.org/download/ngx_openresty-1.9.7.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>博主安装时最新版为1.9.7.1，可以登录<a href="http://openresty.org查看最新版本，选择需要的版本进行下载。" target="_blank" rel="noopener">http://openresty.org查看最新版本，选择需要的版本进行下载。</a><br><br><br>解压下载好的压缩包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xzvf ngx_openresty-1.9.7.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>注意将1.9.7.1替换为你下载的版本号</p>
<blockquote>
<h3 id="3-configure"><a href="#3-configure" class="headerlink" title="3.       ./configure"></a>3.       ./configure</h3></blockquote>
<p>进入 ngx_openresty-VERSION/ 目录, 然后输入以下命令配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>
<p>默认, –prefix=/usr/local/openresty 程序会被安装到/usr/local/openresty目录。<br>我们可以指定各种选项，比如    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/opt/openresty \</span><br><span class="line">            --with-luajit \</span><br><span class="line">            --without-http_redis2_module \</span><br><span class="line">            --with-http_iconv_module \</span><br><span class="line">            --with-http_postgres_module</span><br></pre></td></tr></table></figure>
<p>具体用法参考./configure –help 或者官方文档</p>
<blockquote>
<h3 id="4-编译、安装"><a href="#4-编译、安装" class="headerlink" title="4.编译、安装"></a>4.编译、安装</h3></blockquote>
<p>使用make编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="5-将nginx添加到系统变量"><a href="#5-将nginx添加到系统变量" class="headerlink" title="5.将nginx添加到系统变量"></a>5.将nginx添加到系统变量</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/openresty/nginx/sbin:$PATH</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="6-默认项目路径"><a href="#6-默认项目路径" class="headerlink" title="6.默认项目路径"></a>6.默认项目路径</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/openresty/nginx/html</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="7-启动、关闭、重启nginx"><a href="#7-启动、关闭、重启nginx" class="headerlink" title="7.启动、关闭、重启nginx"></a>7.启动、关闭、重启nginx</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -c /usr/local/openresty/nginx/conf/nginx.conf   //启动并加载配置文件</span><br><span class="line">nginx  -s stop    //停止</span><br><span class="line">nginx  -s reload    //重启</span><br></pre></td></tr></table></figure>
<h1 id="3-mariaDB"><a href="#3-mariaDB" class="headerlink" title="3.mariaDB"></a>3.mariaDB</h1><blockquote>
<h3 id="1-安装依赖库、编译工具"><a href="#1-安装依赖库、编译工具" class="headerlink" title="1.安装依赖库、编译工具"></a>1.安装依赖库、编译工具</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y apr* autoconf automake bison bzip2 bzip2* cloog-ppl cmake compat* cpp curl curl-devel fontconfig fontconfig-devel freetype freetype* freetype-devel gcc gcc-c++ gtk+-devel gd gettext gettext-devel glibc kernel kernel-headers keyutils keyutils-libs-devel krb5-devel libcom_err-devel libpng libpng-devel libjpeg* libsepol-devel libselinux-devel libstdc++-devel libtool* libgomp libxml2 libxml2-devel libXpm* libtiff libtiff* make mpfr ncurses* ntp openssl openssl-devel patch pcre-devel perl php-common php-gd policycoreutils telnet t1lib t1lib* nasm nasm* zlib-devel gd-devel</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="2-创建数据库文件夹，用户组"><a href="#2-创建数据库文件夹，用户组" class="headerlink" title="2.创建数据库文件夹，用户组"></a>2.创建数据库文件夹，用户组</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql &amp;&amp; useradd -g mysql mysql -s /bin/false &amp;&amp;</span><br><span class="line">mkdir -p /data/mysql &amp;&amp;</span><br><span class="line">chown -R mysql:mysql /data/mysql &amp;&amp;</span><br><span class="line">mkdir -p /usr/local/mysql</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="3-下载mariaDB-5-5-47"><a href="#3-下载mariaDB-5-5-47" class="headerlink" title="3.下载mariaDB 5.5.47"></a>3.下载mariaDB 5.5.47</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://sfo1.mirrors.digitalocean.com/mariadb/mariadb-5.5.47/source/mariadb-5.5.47.tar.gz</span><br></pre></td></tr></table></figure>
<p>解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxf mariadb-5.5.47.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>进入目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd mariadb-5.5.47</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h3 id="4-编译、安装mariaDB"><a href="#4-编译、安装mariaDB" class="headerlink" title="4.编译、安装mariaDB"></a>4.编译、安装mariaDB</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/data/mysql -DSYSCONFDIR=/etc &amp;&amp;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>check完之后没什么事可以去喝个茶，博主低配云主机编译了大概12分钟</p>
<blockquote>
<h3 id="5-删除系统自带的mariaDB配置文件"><a href="#5-删除系统自带的mariaDB配置文件" class="headerlink" title="5.删除系统自带的mariaDB配置文件"></a>5.删除系统自带的mariaDB配置文件</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/my.cnf /etc/my.cnf.bak</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="6-初始化数据库，配置启动脚本"><a href="#6-初始化数据库，配置启动脚本" class="headerlink" title="6.初始化数据库，配置启动脚本"></a>6.初始化数据库，配置启动脚本</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql &amp;&amp;</span><br><span class="line">./scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/data/mysql &amp;&amp;</span><br><span class="line">ln -s /usr/local/mysql/my.cnf /etc/my.cnf &amp;&amp;</span><br><span class="line">cp ./support-files/mysql.server /etc/rc.d/init.d/mysqld &amp;&amp;</span><br><span class="line">chmod 755 /etc/init.d/mysqld &amp;&amp;</span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="7-配置mariaDB启动脚本"><a href="#7-配置mariaDB启动脚本" class="headerlink" title="7.配置mariaDB启动脚本"></a>7.配置mariaDB启动脚本</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.d/init.d/mysqld</span><br></pre></td></tr></table></figure>
<p>改动如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">basedir=/usr/local/mysql #MySQL程序安装路径</span><br><span class="line">datadir=/data/mysql #MySQl数据库存放目</span><br></pre></td></tr></table></figure>
<p>然后重启mariaDB<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h3 id="8-将mariaDB加入系统环境变量"><a href="#8-将mariaDB加入系统环境变量" class="headerlink" title="8.将mariaDB加入系统环境变量"></a>8.将mariaDB加入系统环境变量</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;export PATH=$PATH:/usr/local/mysql/bin&apos;&gt;&gt;/etc/profile &amp;&amp; source /etc/profile</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="9-把MariaDB的库文件链接到系统默认的位置，在编译PHP等软件时可以不用指定其库文件地址"><a href="#9-把MariaDB的库文件链接到系统默认的位置，在编译PHP等软件时可以不用指定其库文件地址" class="headerlink" title="9.把MariaDB的库文件链接到系统默认的位置，在编译PHP等软件时可以不用指定其库文件地址"></a>9.把MariaDB的库文件链接到系统默认的位置，在编译PHP等软件时可以不用指定其库文件地址</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/mysql/lib/mysql /usr/lib/mysql &amp;&amp;</span><br><span class="line">ln -s /usr/local/mysql/include/mysql /usr/include/mysql &amp;&amp;</span><br><span class="line">mkdir /var/lib/mysql &amp;&amp;</span><br><span class="line">ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="10-设置root账户mariaDB密码"><a href="#10-设置root账户mariaDB密码" class="headerlink" title="10.设置root账户mariaDB密码"></a>10.设置root账户mariaDB密码</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure>
<p>接下来屏幕会出现一系列代码，代码及操作记录如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysql_secure_installation: line 379: find_mysql_client: command not found</span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line"></span><br><span class="line">In order to log into MariaDB to secure it, we’ll need the current</span><br><span class="line">password for the root user. If you’ve just installed MariaDB, and</span><br><span class="line">you haven’t set the root password yet, the password will be blank,</span><br><span class="line">so you should just press enter here.</span><br><span class="line"></span><br><span class="line">Enter current password for root (enter for none):&lt;– 回车</span><br><span class="line">OK, successfully used password, moving on…</span><br><span class="line"></span><br><span class="line">Setting the root password ensures that nobody can log into the MariaDB</span><br><span class="line">root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line">Set root password? [Y/n] &lt;– y 回车</span><br><span class="line">New password: &lt;– 设置用户名为root的mysql密码</span><br><span class="line">Re-enter new password: &lt;– 密码确认</span><br><span class="line">Password updated successfully!</span><br><span class="line">Reloading privilege tables..</span><br><span class="line">… Success!</span><br><span class="line"></span><br><span class="line">By default, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line">to log into MariaDB without having to have a user account created for</span><br><span class="line">them. This is intended only for testing, and to make the installation</span><br><span class="line">go a bit smoother. You should remove them before moving into a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n] &lt;– y 回车</span><br><span class="line">… Success!</span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed to connect from ‘localhost’. This</span><br><span class="line">ensures that someone cannot guess at the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] &lt;– y 回车</span><br><span class="line">… Success!</span><br><span class="line"></span><br><span class="line">By default, MariaDB comes with a database named ‘test’ that anyone can</span><br><span class="line">access. This is also intended only for testing, and should be removed</span><br><span class="line">before moving into a production environment.</span><br><span class="line"></span><br><span class="line">Remove test database and access to it? [Y/n] &lt;– y 回车</span><br><span class="line">- Dropping test database…</span><br><span class="line">… Success!</span><br><span class="line">- Removing privileges on test database…</span><br><span class="line">… Success!</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] &lt;– y 回车</span><br><span class="line">… Success!</span><br><span class="line"></span><br><span class="line">Cleaning up…</span><br><span class="line"></span><br><span class="line">All done! If you’ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks for using MariaDB!</span><br></pre></td></tr></table></figure>
<p>至此，mariaDB设置完毕</p>
<h1 id="4-php7"><a href="#4-php7" class="headerlink" title="4.php7"></a>4.php7</h1><blockquote>
<h3 id="1-下载php7"><a href="#1-下载php7" class="headerlink" title="1.下载php7"></a>1.下载php7</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c --no-check-certificate -O php7-src-master.zip https://github.com/php/php-src/archive/master.zip</span><br></pre></td></tr></table></figure>
<p>解压<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -q php7-src-master.zip</span><br></pre></td></tr></table></figure></p>
<p>进入目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd php-src-master</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h3 id="2-安装依赖包"><a href="#2-安装依赖包" class="headerlink" title="2.安装依赖包"></a>2.安装依赖包</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libxml2 libxml2-devel openssl openssl-devel curl-devel libjpeg-devel libpng-devel freetype-devel libmcrypt-devel</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="3-编译、安装"><a href="#3-编译、安装" class="headerlink" title="3.编译、安装"></a>3.编译、安装</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./buildconf</span><br></pre></td></tr></table></figure>
<p>此时会生成configure文件，然后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/usr/local/libgd/lib &amp;&amp;</span><br><span class="line">./configure --prefix=/usr/local/php \</span><br><span class="line">--with-config-file-path=/usr/local/php/etc \</span><br><span class="line">--with-mysql=/usr/local/mysql \</span><br><span class="line">--with-mysqli=/usr/local/mysql/bin/mysql_config \</span><br><span class="line">--with-mysql-sock=/tmp/mysql.sock \</span><br><span class="line">--with-pdo-mysql=/usr/local/mysql \</span><br><span class="line">--with-gd \</span><br><span class="line">--with-png-dir=/usr/local/libpng \</span><br><span class="line">--with-jpeg-dir=/usr/local/jpeg \</span><br><span class="line">--with-freetype-dir=/usr/local/freetype \</span><br><span class="line">--with-xpm-dir=/usr/ \</span><br><span class="line">--with-vpx-dir=/usr/local/libvpx/ \</span><br><span class="line">--with-zlib-dir=/usr/local/zlib \</span><br><span class="line">--with-t1lib=/usr/local/t1lib \</span><br><span class="line">--with-iconv \</span><br><span class="line">--enable-libxml \</span><br><span class="line">--enable-xml \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--enable-opcache \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--enable-ftp \</span><br><span class="line">--enable-gd-native-ttf \</span><br><span class="line">--with-openssl \</span><br><span class="line">--enable-pcntl \</span><br><span class="line">--enable-sockets \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--enable-zip \</span><br><span class="line">--enable-soap \</span><br><span class="line">--without-pear \</span><br><span class="line">--with-gettext \</span><br><span class="line">--enable-session \</span><br><span class="line">--with-mcrypt \</span><br><span class="line">--with-curl \</span><br><span class="line">--enable-exif \</span><br><span class="line">--enable-ctype &amp;&amp;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>在check完之后没什么事再去喝个茶吧，博主大概也用了12分钟<br><br>安装完成后提示信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Build complete.</span><br><span class="line">Don&apos;t forget to run &apos;make test&apos;.</span><br><span class="line"></span><br><span class="line">Installing shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/</span><br><span class="line">Installing PHP CLI binary:        /usr/local/php/bin/</span><br><span class="line">Installing PHP CLI man page:      /usr/local/php/php/man/man1/</span><br><span class="line">Installing PHP FPM binary:        /usr/local/php/sbin/</span><br><span class="line">Installing PHP FPM config:        /usr/local/php/etc/</span><br><span class="line">Installing PHP FPM man page:      /usr/local/php/php/man/man8/</span><br><span class="line">Installing PHP FPM status page:      /usr/local/php/php/php/fpm/</span><br><span class="line">Installing phpdbg binary:         /usr/local/php/bin/</span><br><span class="line">Installing phpdbg man page:       /usr/local/php/php/man/man1/</span><br><span class="line">Installing PHP CGI binary:        /usr/local/php/bin/</span><br><span class="line">Installing PHP CGI man page:      /usr/local/php/php/man/man1/</span><br><span class="line">Installing build environment:     /usr/local/php/lib/php/build/</span><br><span class="line">Installing header files:          /usr/local/php/include/php/</span><br><span class="line">Installing helper programs:       /usr/local/php/bin/</span><br><span class="line">  program: phpize</span><br><span class="line">  program: php-config</span><br><span class="line">Installing man pages:             /usr/local/php/php/man/man1/</span><br><span class="line">  page: phpize.1</span><br><span class="line">  page: php-config.1</span><br><span class="line">/root/down/php-src-master/build/shtool install -c ext/phar/phar.phar /usr/local/php/bin</span><br><span class="line">ln -s -f phar.phar /usr/local/php/bin/phar</span><br><span class="line">Installing PDO headers:          /usr/local/php/include/php/ext/pdo/</span><br></pre></td></tr></table></figure>
<p>恭喜你，成功了</p>
<blockquote>
<h3 id="4-复制php配置文件到安装目录："><a href="#4-复制php配置文件到安装目录：" class="headerlink" title="4.复制php配置文件到安装目录："></a>4.复制php配置文件到安装目录：</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp php.ini-production /usr/local/php/etc/php.ini</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="5-备份系统自带配置文件："><a href="#5-备份系统自带配置文件：" class="headerlink" title="5.备份系统自带配置文件："></a>5.备份系统自带配置文件：</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/php.ini /etc/php.ini.bak</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="6-添加软链接到-etc目录："><a href="#6-添加软链接到-etc目录：" class="headerlink" title="6.添加软链接到 /etc目录："></a>6.添加软链接到 /etc目录：</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/php/etc/php.ini /etc/php.ini</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="7-拷贝模板文件为php-fpm配置文件："><a href="#7-拷贝模板文件为php-fpm配置文件：" class="headerlink" title="7.拷贝模板文件为php-fpm配置文件："></a>7.拷贝模板文件为php-fpm配置文件：</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/php/etc/php-fpm.conf.default  /usr/local/php/etc/php-fpm.conf</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="8-添加软连接到-etc目录："><a href="#8-添加软连接到-etc目录：" class="headerlink" title="8.添加软连接到 /etc目录："></a>8.添加软连接到 /etc目录：</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/php/etc/php-fpm.conf /etc/php-fpm.conf</span><br></pre></td></tr></table></figure>
<p><hr><br><em>4-8合并操作</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp php.ini-production /usr/local/php/etc/php.ini &amp;&amp;</span><br><span class="line">mv /etc/php.ini /etc/php.ini.bak &amp;&amp;</span><br><span class="line">ln -s /usr/local/php/etc/php.ini /etc/php.ini &amp;&amp;</span><br><span class="line">cp /usr/local/php/etc/php-fpm.conf.default  /usr/local/php/etc/php-fpm.conf &amp;&amp;</span><br><span class="line">ln -s /usr/local/php/etc/php-fpm.conf /etc/php-fpm.conf</span><br></pre></td></tr></table></figure>
<p><hr></p>
<blockquote>
<h3 id="9-修改php配置文件"><a href="#9-修改php配置文件" class="headerlink" title="9.修改php配置文件"></a>9.修改php配置文件</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/php/etc/php.ini</span><br></pre></td></tr></table></figure>
<h4 id="1-将disable-functions-（禁用掉某些比较“危险”函数，大概在298行），改为"><a href="#1-将disable-functions-（禁用掉某些比较“危险”函数，大概在298行），改为" class="headerlink" title="1.将disable_functions = （禁用掉某些比较“危险”函数，大概在298行），改为"></a>1.将<code>disable_functions =</code> （禁用掉某些比较“危险”函数，大概在298行），改为</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disable_functions = passthru,exec,system,chroot,scandir,chgrp,chown,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,getservbyname,getservbyport,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd, posix_getegid,posix_geteuid,posix_getgid, posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid, posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit, posix_getsid,posix_getuid,posix_isatty, posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid, posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname</span><br></pre></td></tr></table></figure>
<h4 id="2-将expose-php-On-禁止显示php版本的信息，大概在359行-，修改为"><a href="#2-将expose-php-On-禁止显示php版本的信息，大概在359行-，修改为" class="headerlink" title="2.将expose_php = On(禁止显示php版本的信息，大概在359行)，修改为"></a>2.将<code>expose_php = On</code>(禁止显示php版本的信息，大概在359行)，修改为</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expose_php = Off</span><br></pre></td></tr></table></figure>
<h4 id="3-将-date-timezone-（大概在912行），修改为"><a href="#3-将-date-timezone-（大概在912行），修改为" class="headerlink" title="3.将;date.timezone =（大概在912行），修改为"></a>3.将<code>;date.timezone =</code>（大概在912行），修改为</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date.timezone = Asia/Shanghai</span><br></pre></td></tr></table></figure>
<h4 id="4-将"><a href="#4-将" class="headerlink" title="4.将"></a>4.将</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> ;short_open_tag</span><br><span class="line"> ;  Default Value: On</span><br><span class="line"> ;  Development Value: Off</span><br><span class="line"> ;  Production Value: Off</span><br><span class="line">```   </span><br><span class="line">(支持php短标签，大概在151行)，修改为</span><br><span class="line"></span><br><span class="line">``</span><br><span class="line">short_open_tag</span><br><span class="line">   Default Value: On</span><br><span class="line">   Development Value: Off</span><br><span class="line">   Production Value: Off</span><br><span class="line"> ``</span><br><span class="line"></span><br><span class="line">#### 5.将 `;opcache.enable=0` (支持opcode缓存，大概在1732行)，修改为</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">opcache.enable=1</span><br></pre></td></tr></table></figure>
<h4 id="6-将-opcache-enable-cli-0-支持opcode缓存，大概在1735行-，修改为"><a href="#6-将-opcache-enable-cli-0-支持opcode缓存，大概在1735行-，修改为" class="headerlink" title="6.将;opcache.enable_cli=0(支持opcode缓存，大概在1735行)，修改为"></a>6.将<code>;opcache.enable_cli=0</code>(支持opcode缓存，大概在1735行)，修改为</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opcache.enable_cli=1</span><br></pre></td></tr></table></figure>
<p>然后配置opcode缓存，取消以下配置项的注释（从1732行向下）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">opcache.memory_consumption=64</span><br><span class="line">opcache.interned_strings_buffer=4</span><br><span class="line">opcache.max_accelerated_files=2000</span><br><span class="line">opcache.revalidate_freq=2</span><br><span class="line">opcache.fast_shutdown=1</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="10-修改php-fpm配置项"><a href="#10-修改php-fpm配置项" class="headerlink" title="10.修改php-fpm配置项"></a>10.修改php-fpm配置项</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/php/etc/php-fpm.conf</span><br></pre></td></tr></table></figure>
<p>取消注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pid = run/php-fpm.pid</span><br></pre></td></tr></table></figure>
<p>新增</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = www </span><br><span class="line">group = www</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="11-拷贝php-fpm脚本到启动目录-给予执行权限-设置开机启动"><a href="#11-拷贝php-fpm脚本到启动目录-给予执行权限-设置开机启动" class="headerlink" title="11.拷贝php-fpm脚本到启动目录,给予执行权限, 设置开机启动"></a>11.拷贝php-fpm脚本到启动目录,给予执行权限, 设置开机启动</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/src/php-7.1.0/sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm &amp;&amp;</span><br><span class="line">chmod +x /etc/rc.d/init.d/php-fpm &amp;&amp;</span><br><span class="line">chkconfig php-fpm on</span><br></pre></td></tr></table></figure>
<h3 id="12-配置nginx支持php"><a href="#12-配置nginx支持php" class="headerlink" title="12.配置nginx支持php"></a>12.配置nginx支持php</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">location ~ \.php\$ &#123;</span><br><span class="line">root html;</span><br><span class="line">fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME /usr/local/openresty/nginx/html$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="5-配置汇总"><a href="#5-配置汇总" class="headerlink" title="5.配置汇总"></a>5.配置汇总</h1><p>根目录： /usr/local/openresty/nginx/html/<br>Nginx配置文件： /usr/local/openresty/nginx/conf/nginx.conf<br>PHP配置文件： /usr/local/php/etc/php.ini<br>PHP默认拓展文件夹：/usr/lib64/php/modules/<br>PHP拓展可放置于：/usr/local/php/lib/php/extensions/no-debug-non-zts-20151012<br>MySQL配置文件： /etc/my.cnf<br>MySQL程序安装路径： basedir=/usr/local/mysql<br>MySQl数据库存放目录： datadir=/data/mysql</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/database/">database</a>
		  
			<a href="/tags/MySQL/">MySQL</a>
		  
			<a href="/tags/PHP/">PHP</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/01/30/PHP实现抓取淘宝商品价格|人气|图片/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">PHP实现抓取淘宝商品价格|人气|图片</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2015/12/29/Linux系统dist-upgrade和upgrade的区别/">
        <span class="next-text nav-default">linux系统dist-upgrade和upgrade的区别</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2015 -
    
    2020
    <span class="footer-author">EricLi. 鲁ICP备16001445号.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
